name: Cleanup All Workflow Runs
on:
  schedule:
    - cron: '0 0 * * 0'
      timezone: 'Asia/Shanghai'  # 使用北京时间，每周日0点
  workflow_dispatch:              # 允许手动触发

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: Delete all workflow runs
        run: |
          # 删除所有可以删除的记录
          curl -s -H "Authorization: token ${{ secrets.AUTH_PAT }}" \
            "https://api.github.com/repos/${{ github.repository }}/actions/runs?per_page=100" \
            | jq -r '.workflow_runs | map(select(.status != "in_progress")) | .[].id' \
            | xargs -I {} curl -X DELETE \
                -H "Authorization: token ${{ secrets.AUTH_PAT }}" \
                "https://api.github.com/repos/${{ github.repository }}/actions/runs/{}"
